{% extends "layout.html" %}
{% block content %}
  <div class="section">
    <h3>Общие настройки Renderis</h3>
    {% if saved %}
    <div class="notice">Настройки сохранены.</div>
    {% endif %}
    {% if error %}
    <div style="color: var(--danger); font-size: 13px; margin-bottom: 8px;">
      Ошибка загрузки логотипа: {{ error }}.
      Допустимы изображения PNG/JPG/JPEG/WEBP/SVG/ICO/GIF/BMP/AVIF/HEIC/HEIF/JFIF, размер до {{ logo_max_size_mb }} MB.
    </div>
    {% endif %}
    <form method="post" action="/admin/settings" enctype="multipart/form-data">
      <p class="muted" style="margin-top: 6px;">
        Формула: стоимость 1 кредита Renderis (USD) = стоимость 1 звезды (USD) × звезд за 1 кредит.
      </p>
      <div class="form-row">
        <div>
          <label>Звезд за 1 кредит</label>
          <input name="stars_per_credit" value="{{ stars_per_credit }}" />
        </div>
        <div>
          <label>Стоимость 1 звезды (USD)</label>
          <input name="usd_per_star" value="{{ usd_per_star }}" />
        </div>
        <div>
          <label>Стоимость 1 кредита Renderis (USD)</label>
          <input value="{{ usd_per_credit }}" readonly />
        </div>
        <div>
          <label>Стоимость 1 кредита Kie (USD)</label>
          <input name="kie_usd_per_credit" value="{{ kie_usd_per_credit }}" />
        </div>
      </div>

      <div style="height: 16px;"></div>
      <h3 style="margin: 0 0 8px;">Баланс Kie</h3>
      <div class="form-row">
        <div>
          <label>Установить баланс Kie (кредиты)</label>
          <input name="set_kie_balance" placeholder="Например 840" />
        </div>
        <div>
          <label>Добавить кредиты Kie</label>
          <input name="add_kie_credits" placeholder="Например 1000" />
        </div>
        <div>
          <label>Текущий баланс (кредиты)</label>
          <input value="{{ kie_balance_credits }}" readonly />
        </div>
        <div>
          <label>Баланс (USD)</label>
          <input value="{{ kie_balance_usd }}" readonly />
        </div>
      </div>

      <div style="height: 16px;"></div>
      <h3 style="margin: 0 0 8px;">Оповещения по балансу</h3>
      <p class="muted" style="margin-top: 6px;">
        При снижении ниже порога бот отправит уведомление администраторам. Уровни: зелёный → жёлтый → красный.
      </p>
      <div class="form-row">
        <div>
          <label>Зелёный порог (кредиты)</label>
          <input name="kie_warn_green" value="{{ kie_warn_green }}" />
        </div>
        <div>
          <label>Жёлтый порог (кредиты)</label>
          <input name="kie_warn_yellow" value="{{ kie_warn_yellow }}" />
        </div>
        <div>
          <label>Красный порог (кредиты)</label>
          <input name="kie_warn_red" value="{{ kie_warn_red }}" />
        </div>
      </div>

      <div style="height: 16px;"></div>
      <h3 style="margin: 0 0 8px;">Логотип в веб-интерфейсе</h3>
      <p class="muted" style="margin-top: 6px;">
        Поддержка PNG/JPG/WEBP/SVG, до {{ logo_max_size_mb }} MB.
      </p>
      <div class="form-row">
        <div>
          <label>Загрузить новый логотип</label>
          <input type="file" name="logo_file" accept=".png,.jpg,.jpeg,.webp,.svg,image/*" />
        </div>
        <div>
          <label>Удалить текущий логотип</label>
          <label style="display: inline-flex; align-items: center; gap: 8px; margin-top: 8px;">
            <input type="checkbox" name="remove_logo" value="1" style="width: auto;" />
            <span class="muted" style="font-size: 13px;">Удалить лого при сохранении</span>
          </label>
        </div>
        {% if site_logo_url %}
        <div style="grid-column: 1 / -1;">
          <label>Текущий логотип</label>
          <div style="border: 1px solid #2b3f59; background: #0f1b2b; border-radius: 12px; padding: 12px;">
            <img
              src="{{ site_logo_url }}"
              alt="Site logo"
              style="display: block; max-height: 64px; width: auto; border-radius: 8px;"
            />
          </div>
        </div>
        {% endif %}
      </div>

      <div style="height: 16px;"></div>
      <h3 style="margin: 0 0 8px;">Логотип для фавикона</h3>
      <p class="muted" style="margin-top: 6px;">
        Отдельная иконка для вкладки браузера (будет со скруглёнными углами). Поддержка PNG/JPG/WEBP/SVG, до {{ logo_max_size_mb }} MB.
      </p>
      <div class="form-row">
        <div>
          <label>Загрузить логотип фавикона</label>
          <input type="file" name="favicon_file" accept=".png,.jpg,.jpeg,.webp,.svg,image/*" />
        </div>
        <div>
          <label>Удалить текущий фавикон-логотип</label>
          <label style="display: inline-flex; align-items: center; gap: 8px; margin-top: 8px;">
            <input type="checkbox" name="remove_favicon_logo" value="1" style="width: auto;" />
            <span class="muted" style="font-size: 13px;">Удалить при сохранении</span>
          </label>
        </div>
        {% if favicon_logo_url %}
        <div style="grid-column: 1 / -1;">
          <label>Текущий логотип фавикона</label>
          <div style="border: 1px solid #2b3f59; background: #0f1b2b; border-radius: 12px; padding: 12px;">
            <img
              src="{{ favicon_logo_url }}"
              alt="Favicon logo"
              style="display: block; width: 64px; height: 64px; object-fit: cover; border-radius: 12px;"
            />
          </div>
        </div>
        {% endif %}
      </div>
      <div style="margin-top: 12px;">
        <button type="submit">Сохранить</button>
      </div>
    </form>
  </div>
{% endblock %}

